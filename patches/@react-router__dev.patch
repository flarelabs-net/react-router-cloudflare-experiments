diff --git a/dist/vite.js b/dist/vite.js
index d6d41ee82d5bdee34eabfb9b650b7d203b427880..88b1d1caadfd90ec53deadb5f3e5c3624bd535f2 100644
--- a/dist/vite.js
+++ b/dist/vite.js
@@ -3913,7 +3913,16 @@ async function getEnvironmentOptionsResolvers(ctx, buildManifest, viteCommand) {
         rollupOptions: {
           input: (ctx.reactRouterConfig.future.unstable_viteEnvironmentApi ? viteUserConfig.environments?.ssr?.build?.rollupOptions?.input : viteUserConfig.build?.rollupOptions?.input) ?? virtual.serverBuild.id
         }
-      }
+      },
+      optimizeDeps: viteUserConfig.environments?.ssr?.optimizeDeps?.noDiscovery === false ? {
+        entries: [
+          vite2.normalizePath(ctx.entryServerFilePath),
+          ...Object.values(ctx.reactRouterConfig.routes).map((route) =>
+            resolveRelativeRouteFilePath(route, ctx.reactRouterConfig)
+          )
+        ],
+        include: ['react', 'react/jsx-dev-runtime']
+      } : undefined
     });
   }
   return environmentOptionsResolvers;
